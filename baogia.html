<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BÁO GIÁ – HOA LAN HỒ ĐIỆP DŨNG TRANG</title>
  <style>
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --accent:#0b74da;
      --muted:#6b7280;
    }
    body{font-family:Inter, system-ui, Arial, Helvetica, sans-serif; background:var(--bg); margin:0; padding:24px; color:#111}
    .wrap{max-width:980px; margin:0 auto; display:grid; gap:18px; grid-template-columns:1fr 420px;}
    header{grid-column:1/-1; text-align:center; margin-bottom:16px;}
    h1{margin:0; font-size:28px; color: var(--accent);}
    .shop-info{color:#444; font-size:14px; line-height:1.4; margin-top:6px;}
    .card{background:var(--card); border-radius:10px; padding:14px; box-shadow:0 6px 18px rgba(12,12,12,0.06);}
    form .row{display:flex; gap:8px; margin-bottom:10px;}
    label{font-size:13px; color:var(--muted); display:block; margin-bottom:6px}
    input[type="text"], input[type="file"], input[type="number"], input[type="tel"], input[type="date"], select, textarea {
      width:100%; padding:8px 10px; border-radius:8px; border:1px solid #e5e7eb; font-size:14px; box-sizing:border-box;
    }
    .small{font-size:13px; color:var(--muted);}
    button{background:var(--accent); color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer;}
    button.secondary{background:#374151;}
    canvas{width:100%; height:auto; border-radius:8px; background:#fff; display:block;}
    .controls{display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;}
    .right-col{display:flex; flex-direction:column; gap:12px;}
    .info-inline{display:flex; gap:8px;}
    .muted{color:var(--muted)}
    @media (max-width:980px){
      .wrap{grid-template-columns:1fr; padding-bottom:60px;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>BÁO GIÁ</h1>
        <div class="shop-info">
          HOA LAN HỒ ĐIỆP DŨNG TRANG – ĐÀ LẠT<br>
          ĐT / Zalo: 0918.60.42.60<br>
          Địa chỉ: 08 Lý Thường Kiệt, Đức Trọng, Lâm Đồng
        </div>
      </div>
    </header>

    <!-- LEFT: canvas preview & controls -->
    <div class="card">
      <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;">
        <div><strong>Preview ảnh</strong><div class="small muted">Xem trước & điều chỉnh</div></div>
        <div class="info-inline">
          <label class="small muted" style="align-self:center;margin:0 6px 0 0">Định dạng</label>
          <select id="exportFormat" title="Chọn định dạng">
            <option value="image/png">PNG (khuyến nghị)</option>
            <option value="image/jpeg">JPEG</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px;">
        <canvas id="canvas"></canvas>
        <div class="controls">
          <button id="downloadBtn">Tải ảnh xuống</button>
          <button id="downloadJpeg" class="secondary">Tải JPEG (quality 0.9)</button>
          <button id="resetBtn" class="secondary">Xoá & bắt đầu lại</button>
          <label class="small muted" style="align-self:center;margin-left:12px">Ảnh xử lý ở trình duyệt — không upload server</label>
        </div>
      </div>
    </div>

    <!-- RIGHT: form nhập thông tin -->
    <aside class="right-col">
      <div class="card">
        <h3 style="margin:0 0 8px 0">Thông tin ảnh / sản phẩm</h3>
        <form id="dataForm" onsubmit="return false;">
          <div>
            <label for="imageInput">Chọn ảnh sản phẩm</label>
            <input id="imageInput" type="file" accept="image/*" />
          </div>

          <div style="margin-top:10px;">
            <label for="productName">Tên sản phẩm</label>
            <input id="productName" type="text" placeholder="Tên sản phẩm" />
          </div>

          <div style="margin-top:10px;">
            <label for="size">Kích thước / Chi tiết</label>
            <input id="size" type="text" placeholder="Ví dụ: 60‑70cm, 1 cây..." />
          </div>

          <div class="row">
            <div style="flex:1">
              <label for="qty">Số lượng</label>
              <input id="qty" type="number" min="1" value="1" />
            </div>
            <div style="width:130px">
              <label for="unit">Đơn vị</label>
              <select id="unit">
                <option value="cây">cây</option>
                <option value="cành">cành</option>
                <option value="">khác</option>
              </select>
            </div>
          </div>

          <div style="margin-top:8px;">
            <label for="price">Giá</label>
            <input id="price" type="text" value="11x K" />
          </div>

          <div style="margin-top:8px;">
            <label for="phone">Số điện thoại</label>
            <input id="phone" type="tel" value="0918.604260" />
          </div>

          <div class="row" style="margin-top:8px">
            <div style="flex:1">
              <label for="quoteDate">Ngày báo giá</label>
              <input id="quoteDate" type="date" />
            </div>
            <div style="width:120px">
              <label for="fontSize">Kích chữ (thông tin)</label>
              <input id="fontSize" type="number" min="12" max="72" value="20" />
            </div>
          </div>

          <div style="margin-top:8px;">
            <label for="overlayPosition">Vị trí thông tin trên ảnh</label>
            <select id="overlayPosition">
              <option value="bottom">Dưới cùng</option>
              <option value="top">Trên cùng</option>
              <option value="center">Giữa ảnh</option>
            </select>
          </div>

          <div style="margin-top:10px; display:flex; gap:8px;">
            <button id="renderBtn">Tạo ảnh</button>
            <button id="downloadImmediate" class="secondary" type="button">Tạo & tải nhanh</button>
          </div>
        </form>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0">Tùy chọn hiển thị</h3>
        <div style="display:flex; gap:8px; align-items:center;">
          <label style="margin:0">Màu chữ</label>
          <input id="textColor" type="color" value="#ffffff" />
          <label style="margin:0">Màu nền khung</label>
          <input id="boxColor" type="color" value="#000000" />
        </div>
        <div style="margin-top:8px;">
          <label class="small">Độ mờ khung (0‑1)</label>
          <input id="boxOpacity" type="number" min="0" max="1" step="0.05" value="0.6" />
        </div>
        <div style="margin-top:8px;">
          <label class="small">Bo góc khung (px)</label>
          <input id="boxRadius" type="number" min="0" max="60" value="12" />
        </div>
      </div>
    </aside>

  </div>

<script>
const imageInput = document.getElementById('imageInput');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let img = new Image();
let imgLoaded = false;
const MAX_WIDTH = 2000, MAX_HEIGHT = 2000;

const productName = document.getElementById('productName');
const sizeInput = document.getElementById('size');
const qtyInput = document.getElementById('qty');
const unitInput = document.getElementById('unit');
const priceInput = document.getElementById('price');
const phoneInput = document.getElementById('phone');
const quoteDate = document.getElementById('quoteDate');
const fontSizeInput = document.getElementById('fontSize');
const overlayPosition = document.getElementById('overlayPosition');
const textColor = document.getElementById('textColor');
const boxColor = document.getElementById('boxColor');
const boxOpacity = document.getElementById('boxOpacity');
const boxRadius = document.getElementById('boxRadius');

const renderBtn = document.getElementById('renderBtn');
const downloadBtn = document.getElementById('downloadBtn');
const downloadJpeg = document.getElementById('downloadJpeg');
const downloadImmediate = document.getElementById('downloadImmediate');
const resetBtn = document.getElementById('resetBtn');
const exportFormat = document.getElementById('exportFormat');

(function(){
  const d = new Date();
  quoteDate.value = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
})();

imageInput.addEventListener('change', e=>{
  const f = e.target.files?.[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = ev=>{
    img = new Image();
    img.onload = ()=>{
      imgLoaded = true;
      let w = img.width, h = img.height;
      const r = w/h;
      if(w > MAX_WIDTH){ w = MAX_WIDTH; h = Math.round(w/r); }
      if(h > MAX_HEIGHT){ h = MAX_HEIGHT; w = Math.round(h*r); }
      canvas.width = w;
      canvas.height = h;
      ctx.drawImage(img,0,0,w,h);
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(f);
});

function drawOverlay(){
  if(!imgLoaded){ alert('Chưa chọn ảnh sản phẩm!'); return; }
  // vẽ ảnh gốc
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(img,0,0,canvas.width,canvas.height);

  // vẽ dòng mờ shop trên cùng
  ctx.save();
  ctx.globalAlpha = 0.15;
  ctx.fillStyle = "#000";
  ctx.textAlign = "center";
  // font tỉ lệ theo width ảnh — bạn có thể thay số 0.05 nhỏ hơn nếu muốn nhỏ hơn nữa
  const headerFont = Math.round(canvas.width * 0.02);
  ctx.font = `bold ${headerFont}px sans-serif`;
  ctx.fillText("HOA LAN HỒ ĐIỆP DŨNG TRANG - ĐÀ LẠT", canvas.width / 2, 40);
  ctx.restore();

  // thu thập thông tin
  const infoLines = [];
  if(productName.value.trim()) infoLines.push("Tên: " + productName.value.trim());
  if(sizeInput.value.trim()) infoLines.push("Kích thước: " + sizeInput.value.trim());
  if(qtyInput.value) {
    let u = unitInput.value || '';
    infoLines.push("Số lượng: " + qtyInput.value + (u ? " " + u : ""));
  }
  if(priceInput.value.trim()) infoLines.push("Giá: " + priceInput.value.trim());
  if(phoneInput.value.trim()) infoLines.push("SĐT: " + phoneInput.value.trim());
  if(quoteDate.value) {
    const p = quoteDate.value.split("-");
    infoLines.push("Ngày báo giá: " + p[2] + "/" + p[1] + "/" + p[0]);
  }

  if(infoLines.length === 0) return;

  const fs = Math.max(14, Number(fontSizeInput.value) || 18);
  ctx.font = `${fs}px sans-serif`;
  let maxW = 0;
  infoLines.forEach(l => {
    const w = ctx.measureText(l).width;
    if(w > maxW) maxW = w;
  });

  const pad = Math.round(fs * 0.6);
  const lh = Math.round(fs * 1.3);
  const boxW = Math.min(canvas.width - 40, maxW + pad * 2);
  const boxH = infoLines.length * lh + pad * 2;

  let x = 20;
  let y = 20;
  const pos = overlayPosition.value;
  if(pos === "bottom") y = canvas.height - boxH - 20;
  else if(pos === "center"){
    x = Math.round((canvas.width - boxW)/2);
    y = Math.round((canvas.height - boxH)/2);
  }

  ctx.save();
  ctx.globalAlpha = parseFloat(boxOpacity.value) || 0.6;
  ctx.fillStyle = boxColor.value || "#000";
  ctx.fillRect(x, y, boxW, boxH);
  ctx.restore();

  ctx.fillStyle = textColor.value || "#fff";
  ctx.textBaseline = "top";
  ctx.textAlign = "left";
  let ty = y + pad;
  infoLines.forEach(line => {
    ctx.fillText(line, x + pad, ty);
    ty += lh;
  });
}

renderBtn.addEventListener("click", drawOverlay);

downloadBtn.addEventListener("click", ()=>{
  if(!imgLoaded) return;
  const a = document.createElement("a");
  a.href = canvas.toDataURL(exportFormat.value || "image/png");
  a.download = "baogia.png";
  a.click();
});

downloadJpeg?.addEventListener("click", ()=>{
  if(!imgLoaded) return;
  const a = document.createElement("a");
  a.href = canvas.toDataURL("image/jpeg", 0.9);
  a.download = "baogia.jpg";
  a.click();
});

downloadImmediate.addEventListener("click", ()=>{
  drawOverlay();
  const a = document.createElement("a");
  a.href = canvas.toDataURL("image/png");
  a.download = "baogia.png";
  a.click();
});

resetBtn.addEventListener("click", ()=>{
  imgLoaded = false;
  ctx.clearRect(0,0,canvas.width,canvas.height);
});
</script>
</body>
</html>
