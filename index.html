<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Thư viện ảnh GitHub</title>
<style>
  body { font-family: Arial; background:#fafafa; padding:20px; }
  h2 { text-align:center; }
  #folders { text-align:center; margin-bottom:20px; }
  select, button, input[type="file"] {
    padding:10px; font-size:16px; margin:5px;
  }
  .gallery { display:flex; flex-wrap:wrap; gap:15px; justify-content:center; }
  .gallery img {
    width:220px; border-radius:8px;
    box-shadow:0 4px 12px rgba(0,0,0,0.2);
    transition:0.2s;
  }
  .gallery img:hover { transform:scale(1.05); }
</style>
</head>
<body>

<h2>THƯ VIỆN ẢNH</h2>

<div id="folders">
  <label>Chọn thư mục: </label>
  <select id="folderSelect"></select>
</div>

<!-- Form Upload -->
<div style="text-align:center; margin-bottom:20px;">
  <input type="file" id="fileInput" accept="image/*">
  <button onclick="uploadImage()">Upload ảnh</button>
</div>

<div class="gallery" id="gallery"></div>

<script>
const USERNAME = "ductrong49";
const REPO = "dungtrang_orchid";

// ⚠ DÁN TOKEN CỦA BẠN VÀO ĐÂY (token của tài khoản BOT càng tốt)
const TOKEN = "YOUR_GITHUB_TOKEN_HERE";

const repoAPI = `https://api.github.com/repos/${USERNAME}/${REPO}/contents`;

let currentFolder = "";

/* =======================
    LOAD FOLDER LIST
======================= */
async function loadFolders() {
  const res = await fetch(repoAPI);
  const data = await res.json();
  const folders = data.filter(item => item.type === "dir");

  const select = document.getElementById("folderSelect");
  folders.forEach(f => {
    const opt = document.createElement("option");
    opt.value = f.path;
    opt.textContent = f.name;
    select.appendChild(opt);
  });

  currentFolder = folders[0].path;
  loadImages(currentFolder);

  select.addEventListener("change", () => {
    currentFolder = select.value;
    loadImages(currentFolder);
  });
}

/* =======================
    LOAD IMAGES
======================= */
async function loadImages(folder) {
  const url = repoAPI + "/" + folder;
  const res = await fetch(url);
  const files = await res.json();

  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "";

  const images = files.filter(f => /\.(jpg|jpeg|png|gif|webp)$/i.test(f.name));

  images.forEach(img => {
    const el = document.createElement("img");
    el.src = img.download_url;
    gallery.appendChild(el);
  });
}

/* =======================
        UPLOAD IMAGE
======================= */
async function uploadImage() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) {
    alert("Chọn 1 ảnh trước!");
    return;
  }

  const reader = new FileReader();
  reader.onloadend = async () => {
    const base64 = reader.result.split(",")[1];

    const uploadURL = `${repoAPI}/${currentFolder}/${file.name}`;

    const res = await fetch(uploadURL, {
      method: "PUT",
      headers: {
        "Authorization": `Bearer ${TOKEN}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: `Upload ${file.name}`,
        content: base64
      })
    });

    if (res.ok) {
      alert("Upload thành công!");
      loadImages(currentFolder);
    } else {
      alert("Upload thất bại!");
    }
  };

  reader.readAsDataURL(file);
}

loadFolders();
</script>

</body>
</html>
